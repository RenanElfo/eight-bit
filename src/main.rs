mod audio;
mod rythm;
use rythm::{Rythm, RythmBuilder};
mod utils;
use utils::build::Build;
mod time;
mod waves;

fn main() {
    let tempo = 54.0;
    let triangle = waves::TriangleBuilder::default().with_duration_ms(5000.0);
    let pulse = waves::PulseBuilder::default().with_duration_ms(4000.0);
    let mut bass: Rythm<waves::Triangle> = RythmBuilder::default()
        .with_tempo_bpm(tempo)
        .with_decay(audio::basic_filters::Decay(500.0))
        .finalize()
        .unwrap();
    let mut harmony_1: Rythm<waves::Pulse> = RythmBuilder::default()
        .with_tempo_bpm(tempo)
        .with_decay(audio::basic_filters::Decay(400.0))
        .finalize()
        .unwrap();
    let mut harmony_2 = harmony_1.clone();
    let mut harmony_3 = harmony_1.clone();
    let mut harmony_4 = harmony_1.clone();
    let mut harmony_5 = harmony_1.clone();
    let mut melody_1 = harmony_1.clone();
    bass.hits_with_frequency(
        triangle.clone().with_amplitude(4.0).finalize().unwrap(),
        &[(0.75, "g3"), (0.75, "d3")],
    );
    bass.bis(7);
    bass.hits_with_frequency(
        triangle.clone().with_amplitude(4.0).finalize().unwrap(),
        &[
            (0.75, "f#3"),
            (0.75, "b2"),
            (0.75, "e3"),
            (0.75, "e3"),
            (0.75, "d3"),
            (0.75, "a2"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "e3"),
            (0.75, "f#3"),
            (0.75, "b2"),
            (0.75, "e3"),
            (0.75, "e3"),
            (0.75, "e3"),
            (0.75, "a3"),
            (0.75, "d3"),
            (0.75, "g3"),
            (0.75, "d3"),
            (0.75, "g3"),
            (0.75, "d3"),
            (0.75, "g3"),
            (0.75, "d3"),
            (0.75, "g3"),
            (0.75, "d3"),
            (0.75, "g3"),
            (0.75, "d3"),
            (0.75, "g3"),
            (0.75, "d3"),
            (0.75, "g3"),
            (0.75, "d3"),
            (0.75, "g3"),
            (0.75, "d3"),
            (0.75, "f#3"),
            (0.75, "b2"),
            (0.75, "e3"),
            (0.75, "e3"),
            (0.75, "d3"),
            (0.75, "a2"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "d3"),
            (0.75, "e3"),
            (0.75, "e3"),
            (0.75, "e3"),
            (0.75, "e3"),
            (0.75, "e3"),
            (0.75, "e3"),
            (0.75, "a3"),
            (0.75, "d3"),
        ],
    );
    harmony_1.hits_with_frequency(
        pulse.clone().finalize().unwrap(),
        &[(-0.25, ""), (0.5, "b4"), (-0.25, ""), (0.5, "a4")],
    );
    harmony_1.bis(8);
    harmony_1.hits_with_frequency(
        pulse.clone().finalize().unwrap(),
        &[
            (-0.25, ""),
            (0.5, "g4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "f4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "g4"),
            (-0.25, ""),
            (0.5, "d4"),
            (-0.25, ""),
            (0.5, "c4"),
            (-0.25, ""),
            (0.5, "c4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "d4"),
            (-0.25, ""),
            (0.5, "c4"),
            (-0.25, ""),
            (0.5, "c4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.25, "b3"),
            (0.25, "d4"),
            (0.75, "g4"),
            (0.75, "a3"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "g4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "f4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "g4"),
            (-0.25, ""),
            (0.5, "d4"),
            (-0.25, ""),
            (0.5, "c4"),
            (-0.25, ""),
            (0.5, "c4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "d4"),
            (-0.25, ""),
            (0.5, "c4"),
            (-0.25, ""),
            (0.5, "c4"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "c5"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.25, "b3"),
            (0.25, "d4"),
            (0.75, "g4"),
            (0.75, "a3"),
        ],
    );
    harmony_2.hits_with_frequency(
        pulse.clone().finalize().unwrap(),
        &[(-0.25, ""), (0.5, "d5"), (-0.25, ""), (0.5, "c#5")],
    );
    harmony_2.bis(8);
    harmony_2.hits_with_frequency(
        pulse.clone().finalize().unwrap(),
        &[
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "g4"),
            (-0.25, ""),
            (0.5, "e4"),
            (-0.25, ""),
            (0.5, "f#4"),
            (-0.25, ""),
            (0.5, "c5"),
            (-0.25, ""),
            (0.5, "c5"),
            (-0.25, ""),
            (0.5, "g4"),
            (-0.25, ""),
            (0.5, "e4"),
            (-0.25, ""),
            (0.5, "f#4"),
            (-0.25, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.25, "a4"),
            (0.25, "b4"),
            (0.75, "c5"),
            (0.75, "d4"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "c#5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "c5"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "g4"),
            (-0.25, ""),
            (0.5, "e4"),
            (-0.25, ""),
            (0.5, "f#4"),
            (-0.25, ""),
            (0.5, "c5"),
            (-0.25, ""),
            (0.5, "c5"),
            (-0.25, ""),
            (0.5, "g4"),
            (-0.25, ""),
            (0.5, "e4"),
            (-0.25, ""),
            (0.5, "f#4"),
            (-0.25, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "c5"),
            (-0.25, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "c5"),
            (-0.25, ""),
            (0.25, "a4"),
            (0.25, "b4"),
            (0.75, "c5"),
            (0.75, "d4"),
        ],
    );
    harmony_3.hits_with_frequency(
        pulse.clone().finalize().unwrap(),
        &[(-0.25, ""), (0.5, "f#5"), (-0.25, ""), (0.5, "f#5")],
    );
    harmony_3.bis(8);
    harmony_3.hits_with_frequency(
        pulse.clone().finalize().unwrap(),
        &[
            (-1.0, ""),
            (0.5, "g5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "f5"),
            (-0.25, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "g5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "a5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.25, "d5"),
            (0.25, "d5"),
            (0.75, "e5"),
            (0.75, "d5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-0.25, ""),
            (0.5, "f#5"),
            (-1.0, ""),
            (0.5, "g5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "f5"),
            (-0.25, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "b4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "a4"),
            (-0.25, ""),
            (0.5, "g5"),
            (-0.25, ""),
            (0.5, "f5"),
            (-0.25, ""),
            (0.5, "f5"),
            (-0.25, ""),
            (0.5, "a5"),
            (-0.25, ""),
            (0.5, "f5"),
            (-0.25, ""),
            (0.25, "d5"),
            (0.25, "d5"),
            (0.75, "e5"),
            (0.75, "d5"),
        ],
    );
    harmony_4.hits_with_frequency(
        pulse.clone().finalize().unwrap(),
        &[
            (-70.0 / 4.0, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-1.75, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-13.0 / 4.0, ""),
            (0.5, "a5"),
            (-0.5, ""),
            (0.25, "g5"),
            (0.75, "a5"),
            (0.75, "f#5"),
            (-70.0 / 4.0, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-1.75, ""),
            (0.5, "e5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-0.25, ""),
            (0.5, "d5"),
            (-1.0, ""),
            (0.5, "a5"),
            (-1.75, ""),
            (0.5, "a5"),
            (-0.5, ""),
            (0.25, "g5"),
            (0.75, "a5"),
            (0.75, "f5"),
        ],
    );
    harmony_5.hits_with_frequency(
        pulse.clone().finalize().unwrap(),
        &[
            (-38.0 * 3.0 / 4.0, ""),
            (0.75, "a5"),
            (-38.0 * 3.0 / 4.0, ""),
            (0.75, "a5"),
        ],
    );
    melody_1.hits_with_frequency(
        pulse.clone().finalize().unwrap(),
        &[
            (-13.0 / 4.0, ""),
            (0.25, "f#6"),
            (0.25, "a6"),
            (0.25, "g6"),
            (0.25, "f#6"),
            (0.25, "c#6"),
            (0.25, "b5"),
            (0.25, "c#6"),
            (0.25, "d6"),
            (0.75, "a5"),
            (0.75, "f#5"),
            (-10.0 / 4.0, ""),
            (0.25, "f#6"),
            (0.25, "a6"),
            (0.25, "g6"),
            (0.25, "f#6"),
            (0.25, "c#6"),
            (0.25, "b5"),
            (0.25, "c#6"),
            (0.25, "d6"),
            (0.75, "a5"),
            (0.75, "c#6"),
            (0.75, "f#6"),
            (0.75, "e5"),
            (0.75, "e5"),
            (0.75, "e5"),
            (0.25, "a5"),
            (0.25, "b5"),
            (0.25, "c6"),
            (0.25, "e6"),
            (0.25, "d6"),
            (0.25, "b5"),
            (0.25, "d6"),
            (0.25, "c6"),
            (0.25, "b5"),
            (0.75, "d6"),
            (0.5, "d6"),
            (0.25, "d6"),
            (0.25, "e6"),
            (0.25, "f6"),
            (0.25, "g6"),
            (0.25, "a6"),
            (0.25, "c6"),
            (0.25, "d6"),
            (0.25, "e6"),
            (0.25, "d6"),
            (0.25, "b5"),
            (0.75, "d6"),
            (0.5, "d6"),
            (0.25, "d6"),
            (0.75, "g6"),
            (0.75, "f#6"),
            (0.25, "b5"),
            (0.25, "a5"),
            (0.25, "b5"),
            (0.25, "c#6"),
            (0.25, "d6"),
            (0.25, "e6"),
            (0.25, "c#6"),
            (0.25, "d6"),
            (0.25, "e6"),
            (0.75, "f#5"),
            (0.75, "c6"),
            (0.75, "d6"),
            (-3.25, ""),
            (0.25, "f#6"),
            (0.25, "a6"),
            (0.25, "g6"),
            (0.25, "f#6"),
            (0.25, "c#6"),
            (0.25, "b5"),
            (0.25, "c#6"),
            (0.25, "d6"),
            (0.75, "a5"),
            (0.75, "f#5"),
            (0.75, "f#5"),
            (0.75, "f#5"),
            (0.75, "f#5"),
            (-0.25, ""),
            (0.25, "f#6"),
            (0.25, "a6"),
            (0.25, "g6"),
            (0.25, "f#6"),
            (0.25, "c#6"),
            (0.25, "b5"),
            (0.25, "c#6"),
            (0.25, "d6"),
            (0.75, "a5"),
            (0.75, "c#6"),
            (0.75, "f#6"),
            (0.75, "e5"),
            (0.75, "e5"),
            (0.75, "e5"),
            (0.25, "a5"),
            (0.25, "b5"),
            (0.25, "c6"),
            (0.25, "e6"),
            (0.25, "d6"),
            (0.25, "b5"),
            (0.25, "d6"),
            (0.25, "c6"),
            (0.25, "b5"),
            (0.75, "d6"),
            (0.5, "d6"),
            (0.25, "d6"),
            (0.25, "e6"),
            (0.25, "f6"),
            (0.25, "g6"),
            (0.25, "a6"),
            (0.25, "c6"),
            (0.25, "d6"),
            (0.25, "e6"),
            (0.25, "d6"),
            (0.25, "b5"),
            (0.75, "d6"),
            (0.5, "d6"),
            (0.25, "d6"),
            (0.75, "g6"),
            (0.75, "f6"),
            (0.25, "b5"),
            (0.25, "c6"),
            (0.25, "f6"),
            (0.25, "e6"),
            (0.25, "d6"),
            (0.25, "c6"),
            (0.25, "e6"),
            (0.25, "d6"),
            (0.25, "c6"),
            (0.75, "f5"),
            (0.75, "c6"),
            (0.75, "d6"),
        ],
    );
    println!("{}", bass.len() * 4.0 / 3.0);
    let audio_1: audio::Audio = bass.into();
    println!("{}", harmony_1.len() * 4.0 / 3.0);
    let audio_2: audio::Audio = harmony_1.into();
    println!("{}", harmony_2.len() * 4.0 / 3.0);
    let audio_3: audio::Audio = harmony_2.into();
    println!("{}", harmony_3.len() * 4.0 / 3.0);
    let audio_4: audio::Audio = harmony_3.into();
    println!("{}", harmony_4.len() * 4.0 / 3.0);
    let audio_5: audio::Audio = harmony_4.into();
    println!("{}", harmony_5.len() * 4.0 / 3.0);
    let audio_6: audio::Audio = harmony_5.into();
    println!("{}", melody_1.len() * 4.0 / 3.0);
    let audio_7: audio::Audio = melody_1.into();
    let audio = audio_1 / audio_2 / audio_3 / audio_4 / audio_5 / audio_6 / audio_7;
    // let audio = audio.filter_audio(audio::basic_filters::BitCruncher(12));
    audio.write_wav();
}
